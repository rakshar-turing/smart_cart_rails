<h1>Your Shopping Cart</h1>

<div style="display: flex; gap: 2rem;">
  <!-- Main Cart Section -->
  <div style="flex: 3;">
    <% if @cart.cart_items.any? %>
      <ul>
        <% @cart.cart_items.each do |item| %>
          <li>
            <%= item.product.name %> - <%= item.quantity %> Ã— <%= number_to_currency(item.product.price) %>
          </li>
        <% end %>
      </ul>

      <p><strong>Total:</strong> <%= number_to_currency(@cart.cart_items.sum { |i| i.quantity * i.product.price }) %></p>

      <%= button_to "Checkout", checkout_path(@cart), method: :post, class: "btn btn-primary" %>

      <hr>

      <!-- Share Cart Section -->
      <h3>Share your cart</h3>
      <%= button_to "Generate Share Link", share_cart_path(@cart), method: :post, class: "btn btn-outline-secondary" %>

      <% if @cart.share_token.present? %>
        <p>
          Share this link:
          <input type="text" value="<%= @cart.shareable_link %>" readonly style="width: 80%;">
          <button onclick="navigator.clipboard.writeText('<%= @cart.shareable_link %>')">Copy</button>
        </p>
      <% end %>

    <% else %>
      <p>Your cart is empty.</p>
    <% end %>
  </div>

  <!-- Trending Items Sidebar -->
  <aside style="flex: 1; background: #f8f9fa; padding: 1rem; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.1);">
    <h3 style="margin-bottom: 1rem;">ðŸ”¥ Trending Items</h3>
    <div id="trending-items">Loading trending items...</div>
  </aside>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    fetch("<%= trending_items_cart_path(@cart.id) %>")
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById("trending-items");
        if (data.trending.length === 0) {
          container.innerHTML = "<p>No trending items right now.</p>";
          return;
        }

        container.innerHTML = data.trending.map(item => `
          <div style="margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid #ddd;">
            <strong>${item.name}</strong><br>
            â‚¹${item.price}
          </div>
        `).join('');
      })
      .catch(() => {
        document.getElementById("trending-items").innerText = "Unable to load trending items.";
      });
  });
</script>
